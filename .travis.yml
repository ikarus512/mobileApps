# Travis CI file

# https://docs.travis-ci.com/user/languages/javascript-with-nodejs

language: node_js
node_js: "8"
sudo: required

### TODO: sign osx application
### TODO: sign win application
### TODO: build/sign learnLang-ios
### TODO: build learnLang-winphone
### TODO: get version numbers from main package.json to installation info (or create from tags or???)
matrix:
  include:
    - os: osx
      env: JB=005 TOS=ios       APP=learnLang FRM=cordova OPT2=Small
    # ### learnLang: #####################
    # - os: linux
    #   env: JB=010 TOS=android   APP=learnLang FRM=cordova OPT2=Small
    # #- os: linux
    # #  env: JB=020 TOS=android   APP=learnLang FRM=cordova OPT2=Small    DEBUGV=yes
    # - os: linux
    #   env: JB=030 TOS=android   APP=learnLang FRM=cordova
    # #- os: linux
    # #  env: JB=040 TOS=android   APP=learnLang FRM=cordova               DEBUGV=yes
    # - os: linux
    #   env: JB=050 TOS=linux-win APP=learnLang FRM=nwjs
    # #- os: linux
    # #  env: JB=060 TOS=linux-win APP=learnLang FRM=nwjs                  DEBUGV=yes
    # - os: osx
    #   env: JB=070 TOS=osx       APP=learnLang FRM=nwjs
    # #-os: osx
    # # env: JB=080 TOS=osx       APP=learnLang FRM=nwjs                  DEBUGV=yes
    # ### puzzle15: ######################
    # - os: linux
    #   env: JB=090 TOS=android   APP=puzzle15  FRM=cordova-ionic
    # #-os: linux
    # # env: JB=100 TOS=android   APP=puzzle15  FRM=cordova-ionic         DEBUGV=yes
    # #-os: linux
    # # env: JB=110 TOS=linux-win APP=puzzle15  FRM=nwjs-ionic
    # #-os: linux
    # # env: JB=120 TOS=linux-win APP=puzzle15  FRM=nwjs-ionic            DEBUGV=yes
    # #-os: linux
    # # env: JB=130 TOS=osx       APP=puzzle15  FRM=nwjs-ionic
    # #-os: linux
    # # env: JB=140 TOS=osx       APP=puzzle15  FRM=nwjs-ionic            DEBUGV=yes
    # ### tripSave: ######################
    # #-os: linux
    # # env: JB=150 TOS=android   APP=tripSave  FRM=nwjs
    # #-os: linux
    # # env: JB=160 TOS=android   APP=tripSave  FRM=nwjs                  DEBUGV=yes
    # #-os: linux
    # # env: JB=170 TOS=linux-win APP=tripSave  FRM=nwjs
    # #-os: linux
    # # env: JB=180 TOS=linux-win APP=tripSave  FRM=nwjs                  DEBUGV=yes
    # #-os: linux
    # # env: JB=190 TOS=osx       APP=tripSave  FRM=nwjs
    # #-os: linux
    # # env: JB=200 TOS=osx       APP=tripSave  FRM=nwjs                  DEBUGV=yes

branches:
    only:
        - master
    except: # tags starting with vX.X.X (usually commited by travis)
        - /^v?\d+\.\d+\.\d+/

git:
    depth: 20

# cache: ### caching can be slower than not caching (if many folders)
#     timeout: 300 # (5*60 s = 5 min)
#     directories:
#     - $NVM_DIR # $(npm config get prefix)
#     - _tmp_cached/android-sdk-linux
#     - apps/$APP/node_modules
#     - apps/$APP/platforms
#     - apps/$APP/plugins

before_script:
    - export LOCAL_RUN=no
    - export APPNAME=$APP$OPT2
    - export TARGET_OS=$TOS
    - export WORK_DIR=$PWD
    - export APPL_DIR=$WORK_DIR/apps/$APP
    - export RELEASES_DIR=$WORK_DIR/releases
    - export CLONE_DIR=$WORK_DIR/_tmp/mobileApps
    #-export  CXX=g++-4.8 #needed for android???
    - export  ANDROID_MANIFEST=$APPL_DIR/platforms/android/AndroidManifest.xml
    - export  ANDROID_HOME1=$WORK_DIR/_tmp_cached
    - export  ANDROID_HOME=$WORK_DIR/_tmp_cached/android-sdk-linux
    - export  ABTVM=25 ABTVF=25.0.2
    - export  ZIPALIGN=$ANDROID_HOME/build-tools/$ABTVF/zipalign
    # iOS specific:
    - secure: odYuZoeh75aaTmh1Kwm2LeSlcEIYYQIiwLVccvBjB0zlSMKMrEF2DGEoUXIrVc4aZxvKahBzmSL0N6VZX5PRIu5E9nYGz3V3ubefl4BXuZ7YBf5xB4xgqBhXide1dNjW9abbQFpLFNSSZEUgBHgW+6095V4EN3KI3W2jcbYA0rVP8K61p/90O4F73bk36TIEKHOygLUcuL1nQxUHzW6Qjrl9K7UtNMbWnsBetmMrSF/rk+23KjwM4bkv3PB+mAQPkdYn0Ko1VGz6EosGGQ6Xnk5P0c/sSV8Umcm6MVNfRMYsuu8Z58dxTV/OVAXvJPY4o/p7hiAC1wGWsKGvpIgHaQB5DyT9iGGqAsabHatcmY4u/CvQ+mvuuMWpKQZBnADCpRp3AB1xVFh2aKv/CXLK1jHwCMJ/q1REiK3HzaKXCqCvS9hUwiEz/tB9qpdDLI0ZtjJ2qZXITzX5TPKy5TfsvvNahWWFdVjo0PhPb92erfpqmKtG+faRruPcweod/4Rbz9vPUO+mczrnj9AKeMLyzcUAU2Mg/0+x0VlpCtHAwzRNuJsyrhfKAg1GvapNP0N9UJZ8cLXXAC6GBDAZ88JoisDPhlwa6j1knledr20jc7OKcdrrJcDjkMbOe3Ue65Qq63Zd15XkS9oVl4+9Z2lJQV99ESq0xlXjvzReyghwUKI=
    - secure: Mzj4Y1idE4s2R4SCdzt1HLgNFICaha88XQvE6iKZHAFumUO/4vgIizabtLyc1b2o8JFP71JedrS1utc8ADFjvCnbRyOfkHA4UN/+Ksg1OTcGNR8ioj1Myozq8VkmNHoFtJf6UdsQR4ZU7AvJjSCCbtEknl7G9JwwBL20WgVgUol4fipS3n5Iq+xR+Hcr86BYWA8EjG5hkHy0nNGLZhKNxWziXM8trO1C1QcZWkIIAlCz8l3Omv3dCArTHi3y8uvTs5F4aOVLiEVl1NtLeLPs89cxMXeqVxQ/qGI5UhsOdyGHfbf70KUzRSCdNus9pMPwDeltx5vScKz0Kgb7WNOu4CiQN4hysjqIgHoIGmbAChln86hF1SzJb98vXATeU0W6jJFExHKNHcNSXmV91tPNsrcuZaOFLlibo2xpt6AuGvj8OMHGkzbVGIG7hI7jifpzfcHx8Ar4ymQ5deaMONvO0bMFEKGP5reiVPOSTLnUzEPGE/sr9FAxv+TOIsicanIhz5xIHoxDhPypHkzXbmjt416mNfPxj4cg8ttj2ijI9wcnTRQR+zfllw4gy4EC1UUqNNJKMvL57wOvaQmitwkkjCXfIbFEiCJ3tQeeguCIZQM/W7Vsc1gGbN4UgRgWSUqDKQPccAMmFf6po9DU2c4/Fdm2PKVMVqfiRQqf2+E0B6o=
    - export IOS_APP_NAME = learnLang
    - export IOS_PROFILE_NAME = learnLang
    - export IOS_DEVELOPER_NAME="iPhone Distribution: ikarus512@yandex.ru (3UX5BEB7M2)"

    - . $WORK_DIR/scripts/_mydo.sh
    - . $WORK_DIR/scripts/common_before_install.sh
    - . $APPL_DIR/scripts/before_install.sh
    - . $APPL_DIR/scripts/copy.sh
    - . $APPL_DIR/scripts/install.sh
    - . $APPL_DIR/scripts/build.sh

script:
    - ls -lh $RELEASES_DIR || echo 1

after_success:
    - . $WORK_DIR/scripts/deploy_github_releases.sh
    # - . $WORK_DIR/scripts/deploy_heroku.sh
